{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Documentation du backend Gamers ERP","text":"<p>Ce projet fournit les services backend n\u00e9cessaires \u00e0 la gestion des abonnements, des utilisateurs et des op\u00e9rations financi\u00e8res du syst\u00e8me Gamers ERP.</p>"},{"location":"#resume-du-projet","title":"R\u00e9sum\u00e9 du projet","text":"<p>L'API est con\u00e7ue avec une approche Design-First utilisant OpenAPI pour garantir un contrat d'interface robuste. Elle suit une architecture en couches pour assurer la s\u00e9paration des pr\u00e9occupations et la testabilit\u00e9.</p>"},{"location":"#points-cles","title":"Points cl\u00e9s :","text":"<ul> <li>S\u00e9curit\u00e9 : Authentification JWT centralis\u00e9e et gestion des permissions par bitmask.</li> <li>Flexibilit\u00e9 : Support multi-base de donn\u00e9es (SQLite en m\u00e9moire pour le dev/test, PostgreSQL pour la prod).</li> <li>Automatisation : G\u00e9n\u00e9ration de code (routes, types, sch\u00e9mas de validation) depuis la spec OpenAPI.</li> </ul>"},{"location":"#flux-de-communication","title":"Flux de communication","text":"<p>Le diagramme suivant illustre le cheminement d'une requ\u00eate type \u00e0 travers les diff\u00e9rents composants du syst\u00e8me :</p> <pre><code>graph TD\n    Client([Client]) -- \"Requ\u00eate HTTP (JWT)\" --&gt; Gateway[Connect Gateway]\n\n    subgraph \"S\u00e9curit\u00e9 &amp; Routing\"\n    Gateway -- \"1. V\u00e9rification Permissions\" --&gt; RouteConfig[Route Config]\n    end\n\n    Gateway -- \"2. Appel Handler\" --&gt; Handlers[API Handlers]\n\n    subgraph \"Logique M\u00e9tier\"\n    Handlers -- \"3. Appel\" --&gt; Repos[Repositories]\n    end\n\n    subgraph \"Persistance\"\n    Repos -- \"4. Requ\u00eate SQL\" --&gt; DB[(Base de Donn\u00e9es)]\n    end\n\n    DB -.-&gt; Repos\n    Repos -.-&gt; Handlers\n    Handlers -.-&gt; Gateway\n    Gateway -.-&gt; Client</code></pre>"},{"location":"#navigation-rapide","title":"Navigation rapide","text":"<ul> <li>Architecture Decision Records : Les choix techniques structurants du projet.</li> <li>D\u00e9marrage rapide : Installation et ex\u00e9cution du projet.</li> <li>R\u00e9f\u00e9rence API : D\u00e9tails des endpoints par domaine m\u00e9tier.</li> </ul>"},{"location":"demarrage-rapide/","title":"ERP CNAM - BACK","text":"<p>API de gestion des joueurs abonn\u00e9s pour l'application ERP CNAM.</p> <p>Choix d'architecture : Design First avec g\u00e9n\u00e9ration automatique du code depuis OpenAPI</p>"},{"location":"demarrage-rapide/#demarrage-rapide","title":"D\u00e9marrage rapide","text":"<pre><code># Cloner et installer\ngit clone https://github.com/ERP-CNAM/back.git\ncd back\nnpm install\n\n# D\u00e9finisser les variables d'environnement\ncp .env.example .env\n\n# Lancer en mode d\u00e9veloppement\nnpm run dev\n</code></pre> <p>L'API sera accessible sur <code>http://localhost:3000</code> et la documentation de l'API sur <code>http://localhost:3000/swagger</code>.</p>"},{"location":"demarrage-rapide/#workflow-design-to-code-api","title":"Workflow Design to Code API","text":"<p>Ce projet suit une approche Design First : vous d\u00e9finissez d'abord le contrat API dans OpenAPI, puis le code est g\u00e9n\u00e9r\u00e9 automatiquement.</p>"},{"location":"demarrage-rapide/#1-design-definir-lapi","title":"1. Design - D\u00e9finir l'API","text":"<p>Modifiez <code>api/spec/openapi.yaml</code> pour ajouter ou modifier un endpoint.</p>"},{"location":"demarrage-rapide/#2-generate-generer-les-interfaces-routes-et-types","title":"2. Generate - G\u00e9n\u00e9rer les interfaces, routes, et types","text":"<pre><code>npm run generate\n</code></pre> <p>Cette commande g\u00e9n\u00e8re automatiquement dans <code>api/</code> :</p> <ul> <li>Types TypeScript (<code>GetUser</code>, <code>GetUserResponder</code>)</li> <li>Sch\u00e9mas de validation Zod v4 (dans <code>schemas.ts</code>)</li> <li>Interface <code>Implementation</code> pour assembler les handlers</li> </ul>"},{"location":"demarrage-rapide/#3-implement-implementer-la-logique-metier","title":"3. Implement - Impl\u00e9menter la logique m\u00e9tier","text":"<p>Cr\u00e9ez votre handler dans le sous-r\u00e9pertoire appropri\u00e9 de <code>src/handler/</code> (public, authenticated, admin) en utilisant les types g\u00e9n\u00e9r\u00e9s.</p> <p>Enregistrez ensuite le handler dans <code>src/handler/index.ts</code>.</p>"},{"location":"demarrage-rapide/#4-secure-configurer-la-securite","title":"4. Secure - Configurer la s\u00e9curit\u00e9","text":"<p>Toute nouvelle route doit \u00eatre d\u00e9clar\u00e9e dans <code>src/middleware/routes.config.ts</code> pour d\u00e9finir son niveau d'acc\u00e8s (public, authenticated, admin).</p>"},{"location":"demarrage-rapide/#structure-du-projet","title":"Structure du projet","text":"<pre><code>back/\n\u251c\u2500\u2500 api/\n\u2502   \u251c\u2500\u2500 spec/\n\u2502   \u2502   \u2514\u2500\u2500 openapi.yaml    # Source de v\u00e9rit\u00e9 - Contrat API\n\u2502   \u251c\u2500\u2500 generated.ts        # Routeur Express g\u00e9n\u00e9r\u00e9\n\u2502   \u251c\u2500\u2500 models.ts           # Types TypeScript g\u00e9n\u00e9r\u00e9s\n\u2502   \u2514\u2500\u2500 schemas.ts          # Validations Zod g\u00e9n\u00e9r\u00e9es\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 handler/            # Logique m\u00e9tier par niveau d'acc\u00e8s\n\u2502   \u2502   \u251c\u2500\u2500 public/         # Routes publiques (login, reg)\n\u2502   \u2502   \u251c\u2500\u2500 authenticated/  # Routes utilisateurs connect\u00e9s\n\u2502   \u2502   \u2514\u2500\u2500 admin/          # Routes administrateurs\n\u2502   \u251c\u2500\u2500 repository/         # Acc\u00e8s aux donn\u00e9es (In-memory &amp; Postgres)\n\u2502   \u251c\u2500\u2500 database/           # Sch\u00e9mas et migrations (Drizzle)\n\u2502   \u251c\u2500\u2500 middleware/         # Auth et s\u00e9curit\u00e9 des routes\n\u2502   \u2514\u2500\u2500 index.ts            # Point d'entr\u00e9e Express\n\u251c\u2500\u2500 docs/                   # Documentation et ADRs\n\u2514\u2500\u2500 test/                   # Tests unitaires et int\u00e9gration\n</code></pre>"},{"location":"demarrage-rapide/#technologies-utilisees","title":"Technologies utilis\u00e9es","text":"<ul> <li>Runtime : Node.js + TypeScript</li> <li>API Framework : Express</li> <li>ORM : Drizzle ORM</li> <li>Base de donn\u00e9es : SQLite in-memory (dev/tests) &amp; PostgreSQL (prod)</li> <li>Validation : Zod</li> <li>Tests : Vitest</li> <li>G\u00e9n\u00e9rateur : @nahkies/openapi-code-generator</li> </ul>"},{"location":"demarrage-rapide/#support","title":"Support","text":"<p>Pour toute question ou probl\u00e8me, ouvrez une issue sur GitHub.</p>"},{"location":"demarrage-rapide/#documentation","title":"Documentation","text":"<p>Une documentation compl\u00e8te incluant l'architecture (ADR) et les d\u00e9tails des logiques impl\u00e9ment\u00e9es est disponible et consultable en ligne sur : https://erp-cnam.github.io/back/</p>"},{"location":"api/","title":"API Reference","text":"<p>Bienvenue dans la documentation d\u00e9taill\u00e9e de l'API Gamers ERP. Cette documentation est organis\u00e9e par domaine m\u00e9tier pour faciliter son exploitation par les consommateurs et les d\u00e9veloppeurs.</p>"},{"location":"api/#domaines-metiers","title":"Domaines m\u00e9tiers","text":"<p>L'API est divis\u00e9e en quatre piliers principaux :</p>"},{"location":"api/#1-authentification","title":"1. Authentification","text":"<p>Gestion des jetons JWT pour les utilisateurs et les administrateurs.</p>"},{"location":"api/#2-gestion-des-utilisateurs","title":"2. Gestion des Utilisateurs","text":"<p>Inscription des joueurs, consultation des profils et administration des comptes par les \u00e9quipes de support.</p>"},{"location":"api/#3-gestion-des-abonnements","title":"3. Gestion des Abonnements","text":"<p>Cycle de vie des abonnements mensuels, de la cr\u00e9ation \u00e0 la r\u00e9siliation.</p>"},{"location":"api/#4-finance-et-operations","title":"4. Finance et Op\u00e9rations","text":"<p>Processus de facturation mensuelle, exports vers les logiciels MONEY (Comptabilit\u00e9) et BANK (Banque), rapports de chiffre d'affaires.</p>"},{"location":"api/#niveaux-de-securite","title":"Niveaux de s\u00e9curit\u00e9","text":"<p>Chaque endpoint de l'API appartient \u00e0 l'un des trois niveaux suivants :</p> <ul> <li>Public : Aucune authentification requise.</li> <li>Authentifi\u00e9 : N\u00e9cessite un jeton JWT valide (Joueur ou Admin).</li> <li>Admin : R\u00e9serv\u00e9 exclusivement aux administrateurs.</li> </ul>"},{"location":"api/#format-des-reponses","title":"Format des r\u00e9ponses","text":"<p>Toutes les r\u00e9ponses de l'API suivent un format standardis\u00e9 :</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Description optionnelle du r\u00e9sultat\",\n  \"payload\": {\n    \"data\": \"...\"\n  }\n}\n</code></pre>"},{"location":"api/abonnements/","title":"Gestion des abonnements","text":"<p>Cette section concerne le cycle de vie des abonnements aux services Gamers ERP.</p>"},{"location":"api/abonnements/#principes-generaux","title":"Principes g\u00e9n\u00e9raux","text":"<ul> <li>Les abonnements sont mensuels.</li> <li>Tout mois commenc\u00e9 est d\u00fb int\u00e9gralement (pas de prorata).</li> <li>Un abonnement lie un utilisateur \u00e0 une offre via un <code>contractCode</code>.</li> </ul>"},{"location":"api/abonnements/#operations-dabonnement","title":"Op\u00e9rations d'abonnement","text":"<p>Note : Ces endpoints sont accessibles aux utilisateurs (pour leur propre compte) et aux administrateurs.</p>"},{"location":"api/abonnements/#creer-un-abonnement","title":"Cr\u00e9er un abonnement","text":"<p>Active un nouvel abonnement pour un joueur.</p> <ul> <li>M\u00e9thode : <code>POST</code></li> <li>Chemin : <code>/subscriptions</code></li> <li>Acc\u00e8s : Authentifi\u00e9</li> </ul>"},{"location":"api/abonnements/#exemple-de-requete","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"userId\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n  \"contractCode\": \"GAMER_GOLD_2026\",\n  \"startDate\": \"2026-02-01\",\n  \"monthlyAmount\": 19.99,\n  \"promoCode\": \"WELCOME2026\"\n}\n</code></pre>"},{"location":"api/abonnements/#exemple-de-reponse-201-created","title":"Exemple de r\u00e9ponse (201 Created)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Subscription created successfully\",\n  \"payload\": {\n    \"id\": \"sub-uuid-123\",\n    \"userId\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n    \"contractCode\": \"GAMER_GOLD_2026\",\n    \"status\": \"ACTIVE\",\n    \"monthlyAmount\": 19.99,\n    \"startDate\": \"2026-02-01\",\n    \"promoCode\": \"WELCOME2026\"\n  }\n}\n</code></pre>"},{"location":"api/abonnements/#lister-les-abonnements","title":"Lister les abonnements","text":"<p>Liste les abonnements actifs ou pass\u00e9s.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/subscriptions</code></li> <li>Acc\u00e8s : Authentifi\u00e9</li> <li>Param\u00e8tres (Query) :</li> <li><code>userId</code> : (Optionnel) Filtrer par utilisateur.</li> <li><code>status</code> : (Optionnel) Filtrer par statut (<code>ACTIVE</code>, <code>CANCELLED</code>).</li> </ul>"},{"location":"api/abonnements/#exemple-de-reponse-200-ok","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Subscriptions retrieved successfully\",\n  \"payload\": [\n    {\n      \"id\": \"sub-uuid-123\",\n      \"userId\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n      \"contractCode\": \"GAMER_GOLD_2026\",\n      \"status\": \"ACTIVE\",\n      \"monthlyAmount\": 19.99,\n      \"startDate\": \"2026-02-01\",\n      \"endDate\": null,\n      \"user\": {\n        \"id\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n        \"firstName\": \"Alice\",\n        \"lastName\": \"Smith\",\n        \"email\": \"alice.smith@example.com\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"api/abonnements/#consulter-un-abonnement","title":"Consulter un abonnement","text":"<p>R\u00e9cup\u00e8re les d\u00e9tails d'un abonnement sp\u00e9cifique, incluant les informations de l'utilisateur rattach\u00e9.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/subscriptions/{subscriptionId}</code></li> <li>Acc\u00e8s : Authentifi\u00e9</li> </ul>"},{"location":"api/abonnements/#exemple-de-reponse-200-ok_1","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Subscription retrieved successfully\",\n  \"payload\": {\n    \"id\": \"sub-uuid-123\",\n    \"userId\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n    \"contractCode\": \"GAMER_GOLD_2026\",\n    \"status\": \"ACTIVE\",\n    \"monthlyAmount\": 19.99,\n    \"startDate\": \"2026-02-01\",\n    \"endDate\": null,\n    \"promoCode\": \"WELCOME2026\",\n    \"user\": {\n      \"id\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n      \"firstName\": \"Alice\",\n      \"lastName\": \"Smith\",\n      \"email\": \"alice.smith@example.com\",\n      \"status\": \"OK\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/abonnements/#mettre-a-jour-un-abonnement","title":"Mettre \u00e0 jour un abonnement","text":"<p>Modifie les d\u00e9tails d'un abonnement existant.</p> <ul> <li>M\u00e9thode : <code>PUT</code></li> <li>Chemin : <code>/subscriptions/{subscriptionId}</code></li> <li>Acc\u00e8s : Authentifi\u00e9</li> </ul>"},{"location":"api/abonnements/#exemple-de-requete_1","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"monthlyAmount\": 24.99,\n  \"promoCode\": null\n}\n</code></pre>"},{"location":"api/abonnements/#exemple-de-reponse-200-ok_2","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Subscription updated successfully\",\n  \"payload\": {\n    \"id\": \"sub-uuid-123\",\n    \"contractCode\": \"GAMER_GOLD_2026\",\n    \"status\": \"ACTIVE\",\n    \"monthlyAmount\": 24.99,\n    \"startDate\": \"2026-02-01\",\n    \"promoCode\": null\n  }\n}\n</code></pre>"},{"location":"api/abonnements/#resilier-un-abonnement","title":"R\u00e9silier un abonnement","text":"<p>Met fin \u00e0 un abonnement \u00e0 la fin de la p\u00e9riode en cours.</p> <ul> <li>M\u00e9thode : <code>DELETE</code></li> <li>Chemin : <code>/subscriptions/{subscriptionId}</code></li> <li>Acc\u00e8s : Authentifi\u00e9</li> </ul>"},{"location":"api/abonnements/#exemple-de-reponse-200-ok_3","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Subscription cancelled successfully\",\n  \"payload\": {\n    \"id\": \"sub-uuid-123\",\n    \"contractCode\": \"GAMER_GOLD_2026\",\n    \"status\": \"CANCELLED\",\n    \"monthlyAmount\": 19.99,\n    \"startDate\": \"2026-02-01\",\n    \"endDate\": \"2026-02-28\"\n  }\n}\n</code></pre>"},{"location":"api/authentification/","title":"Authentification","text":"<p>Cette section d\u00e9crit comment s'authentifier aupr\u00e8s de l'API Gamers ERP pour obtenir un jeton d'acc\u00e8s (JWT).</p>"},{"location":"api/authentification/#niveaux-dacces","title":"Niveaux d'acc\u00e8s","text":"Niveau Description Public Accessible \u00e0 tous sans jeton. Authentifi\u00e9 N\u00e9cessite un jeton JWT valide port\u00e9 par l'en-t\u00eate <code>Authorization</code>. Admin N\u00e9cessite un jeton JWT poss\u00e9dant des droits d'administrateur."},{"location":"api/authentification/#connexion-utilisateur","title":"Connexion utilisateur","text":"<p>Permet \u00e0 un joueur de se connecter pour g\u00e9rer ses abonnements.</p> <ul> <li>M\u00e9thode : <code>POST</code></li> <li>Chemin : <code>/auth/login</code></li> <li>Acc\u00e8s : Public</li> </ul>"},{"location":"api/authentification/#exemple-de-requete","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"email\": \"john.doe@example.com\",\n  \"password\": \"Password123!\"\n}\n</code></pre>"},{"location":"api/authentification/#exemple-de-reponse-200-ok","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Connexion r\u00e9ussie\",\n  \"payload\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"user\": {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"firstName\": \"John\",\n      \"lastName\": \"Doe\",\n      \"email\": \"john.doe@example.com\",\n      \"status\": \"OK\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/authentification/#connexion-administrateur","title":"Connexion administrateur","text":"<p>Permet \u00e0 un administrateur d'acc\u00e9der aux fonctions de gestion globale, facturation et exports.</p> <ul> <li>M\u00e9thode : <code>POST</code></li> <li>Chemin : <code>/auth/admin/login</code></li> <li>Acc\u00e8s : Public</li> </ul>"},{"location":"api/authentification/#exemple-de-requete_1","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"email\": \"admin@gamers-erp.com\",\n  \"password\": \"AdminPassword123!\"\n}\n</code></pre>"},{"location":"api/authentification/#exemple-de-reponse-200-ok_1","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Connexion r\u00e9ussie\",\n  \"payload\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"admin\": {\n      \"id\": \"admin-uuid\",\n      \"email\": \"admin@gamers-erp.com\",\n      \"firstName\": \"Super\",\n      \"lastName\": \"Admin\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/authentification/#utilisation-du-token","title":"Utilisation du token","text":"<p>Une fois le token obtenu, il doit \u00eatre inclus dans chaque requ\u00eate prot\u00e9g\u00e9e via l'en-t\u00eate <code>Authorization</code>.</p> <p>Exemple : <code>Authorization: Bearer &lt;votre_token_jwt&gt;</code></p>"},{"location":"api/finance-operations/","title":"Finance et op\u00e9rations","text":"<p>Cette section d\u00e9crit les fonctions critiques li\u00e9es \u00e0 la facturation, aux exports vers les syst\u00e8mes tiers et aux rapports financiers.</p> <p>Note : Tous les endpoints de cette section n\u00e9cessitent un token Administrateur ou une cl\u00e9 API valide de Connect.</p>"},{"location":"api/finance-operations/#facturation-mensuelle","title":"Facturation mensuelle","text":"<p>D\u00e9clenche la g\u00e9n\u00e9ration des factures pour tous les abonnements actifs. Cette op\u00e9ration doit \u00eatre effectu\u00e9e une fois par mois.</p> <ul> <li>M\u00e9thode : <code>POST</code></li> <li>Chemin : <code>/billing/monthly</code></li> <li>Acc\u00e8s : Admin</li> </ul>"},{"location":"api/finance-operations/#exemple-de-requete","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"billingDate\": \"2026-06-30\"\n}\n</code></pre>"},{"location":"api/finance-operations/#exemple-de-reponse-200-ok","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Generated 3 invoices successfully\",\n  \"payload\": {\n    \"billingDate\": \"2026-06-30\",\n    \"invoices\": [\n      {\n        \"id\": \"inv-001\",\n        \"invoiceRef\": \"INV-2026-06-C001\",\n        \"subscriptionId\": \"sub-uuid-123\",\n        \"userId\": \"user-uuid-456\",\n        \"amountExclVat\": 19.99,\n        \"vatAmount\": 4.0,\n        \"amountInclVat\": 23.99,\n        \"status\": \"PENDING\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"api/finance-operations/#liste-des-factures","title":"Liste des factures","text":"<p>R\u00e9cup\u00e8re toutes les factures avec filtres optionnels.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/invoices</code></li> <li>Acc\u00e8s : Admin</li> <li>Param\u00e8tres (Query) :</li> <li><code>userId</code> : Filtrer par utilisateur.</li> <li><code>subscriptionId</code> : Filtrer par abonnement.</li> <li><code>status</code> : Filtrer par statut (<code>PENDING</code>, <code>SENT</code>, <code>PAID</code>, <code>FAILED</code>).</li> </ul>"},{"location":"api/finance-operations/#exemple-de-reponse-200-ok_1","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Invoices retrieved successfully\",\n  \"payload\": [\n    {\n      \"id\": \"inv-001\",\n      \"invoiceRef\": \"INV-2026-06-C001\",\n      \"subscriptionId\": \"sub-uuid-123\",\n      \"userId\": \"user-uuid-456\",\n      \"billingDate\": \"2026-06-30\",\n      \"periodStart\": \"2026-06-01\",\n      \"periodEnd\": \"2026-06-30\",\n      \"amountExclVat\": 19.99,\n      \"vatAmount\": 4.0,\n      \"amountInclVat\": 23.99,\n      \"status\": \"PAID\",\n      \"subscription\": {\n        \"contractCode\": \"GAMER_GOLD_2026\",\n        \"user\": {\n          \"firstName\": \"Alice\",\n          \"lastName\": \"Smith\"\n        }\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"api/finance-operations/#exports-tiers","title":"Exports Tiers","text":""},{"location":"api/finance-operations/#logiciel-money-comptabilite","title":"Logiciel MONEY (Comptabilit\u00e9)","text":"<p>G\u00e9n\u00e8re un fichier d'\u00e9critures comptables pour le groupe Money.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/exports/accounting/monthly-invoices</code></li> <li>Acc\u00e8s : Admin</li> <li>Param\u00e8tre (Query) : <code>billingMonth</code> (Format: YYYY-MM, ex: <code>2026-06</code>)</li> </ul>"},{"location":"api/finance-operations/#exemple-de-reponse-200-ok_2","title":"Exemple de R\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Export generated for 2026-06\",\n  \"payload\": [\n    {\n      \"date\": \"2026-06-30\",\n      \"generalAccount\": \"411\",\n      \"clientAccount\": \"AUX_SMITH\",\n      \"invoiceRef\": \"INV-2026-06-C001\",\n      \"description\": \"Facturation abonnement mensuel - Alice Smith\",\n      \"debit\": 23.99,\n      \"credit\": null,\n      \"customerName\": \"Alice Smith\"\n    },\n    {\n      \"date\": \"2026-06-30\",\n      \"generalAccount\": \"700\",\n      \"clientAccount\": null,\n      \"invoiceRef\": \"INV-2026-06-C001\",\n      \"description\": \"Prestation de service HT\",\n      \"debit\": null,\n      \"credit\": 19.99,\n      \"customerName\": \"Alice Smith\"\n    },\n    {\n      \"date\": \"2026-06-30\",\n      \"generalAccount\": \"445\",\n      \"clientAccount\": null,\n      \"invoiceRef\": \"INV-2026-06-C001\",\n      \"description\": \"TVA collect\u00e9e 20%\",\n      \"debit\": null,\n      \"credit\": 4.0,\n      \"customerName\": \"Alice Smith\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/finance-operations/#logiciel-bank-banque","title":"Logiciel BANK (Banque)","text":"<p>G\u00e9n\u00e8re la liste des ordres de pr\u00e9l\u00e8vement pour le groupe Bank.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/exports/banking/direct-debits</code></li> <li>Acc\u00e8s : Admin</li> <li>Param\u00e8tre (Query) : <code>executionDate</code> (Format: YYYY-MM-DD, ex: <code>2026-07-01</code>)</li> </ul>"},{"location":"api/finance-operations/#exemple-de-reponse-200-ok_3","title":"Exemple de R\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Generated 2 direct debit orders for execution on 2026-07-01\",\n  \"payload\": [\n    {\n      \"id\": \"dd-001\",\n      \"invoiceId\": \"inv-001\",\n      \"userId\": \"user-uuid-456\",\n      \"executionDate\": \"2026-07-01\",\n      \"amount\": 23.99,\n      \"status\": \"TO_SEND\",\n      \"paymentMethod\": \"SEPA\"\n    },\n    {\n      \"id\": \"dd-002\",\n      \"invoiceId\": \"inv-002\",\n      \"userId\": \"user-uuid-789\",\n      \"executionDate\": \"2026-07-01\",\n      \"amount\": 19.99,\n      \"status\": \"TO_SEND\",\n      \"paymentMethod\": \"CARD\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/finance-operations/#webhook-banque-retour-de-paiement","title":"Webhook Banque (Retour de Paiement)","text":"<p>Permet \u00e0 la banque de notifier le syst\u00e8me du succ\u00e8s ou du rejet des pr\u00e9l\u00e8vements.</p> <ul> <li>M\u00e9thode : <code>POST</code></li> <li>Chemin : <code>/bank/payment-updates</code></li> <li>Acc\u00e8s : Admin (IP filtr\u00e9e ou signature secret dans un sc\u00e9nario r\u00e9el)</li> </ul>"},{"location":"api/finance-operations/#exemple-de-requete_1","title":"Exemple de Requ\u00eate","text":"<pre><code>[\n  {\n    \"invoiceId\": \"inv-001\",\n    \"status\": \"EXECUTED\"\n  },\n  {\n    \"invoiceId\": \"inv-002\",\n    \"status\": \"REJECTED\",\n    \"rejectionReason\": \"Solde insuffisant\"\n  }\n]\n</code></pre>"},{"location":"api/finance-operations/#exemple-de-reponse-200-ok_4","title":"Exemple de R\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Payment statuses updated\",\n  \"payload\": {\n    \"updatedCount\": 2\n  }\n}\n</code></pre>"},{"location":"api/finance-operations/#rapports","title":"Rapports","text":""},{"location":"api/finance-operations/#chiffre-daffaires-mensuel","title":"Chiffre d'Affaires Mensuel","text":"<p>R\u00e9cup\u00e8re le CA (HT, TVA, TTC) agr\u00e9g\u00e9 par mois.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/reports/revenue/monthly</code></li> <li>Acc\u00e8s : Admin</li> <li>Param\u00e8tres (Query) :</li> <li><code>from</code> : Mois de d\u00e9but (YYYY-MM).</li> <li><code>to</code> : Mois de fin (YYYY-MM).</li> </ul>"},{"location":"api/finance-operations/#exemple-de-reponse-200-ok_5","title":"Exemple de R\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Revenue report generated from 2026-01 to 2026-06\",\n  \"payload\": [\n    {\n      \"month\": \"2026-01\",\n      \"revenueExclVat\": 500.0,\n      \"vatAmount\": 100.0,\n      \"revenueInclVat\": 600.0\n    },\n    {\n      \"month\": \"2026-02\",\n      \"revenueExclVat\": 750.0,\n      \"vatAmount\": 150.0,\n      \"revenueInclVat\": 900.0\n    },\n    {\n      \"month\": \"2026-06\",\n      \"revenueExclVat\": 1000.0,\n      \"vatAmount\": 200.0,\n      \"revenueInclVat\": 1200.0\n    }\n  ]\n}\n</code></pre>"},{"location":"api/utilisateurs/","title":"Gestion des utilisateurs","text":"<p>Cette section d\u00e9taille les op\u00e9rations relatives aux comptes utilisateurs (joueurs).</p>"},{"location":"api/utilisateurs/#inscription","title":"Inscription","text":"<p>Cr\u00e9ation d'un nouveau compte joueur. Cet endpoint est g\u00e9n\u00e9ralement appel\u00e9 lors d'une inscription sur la plateforme Gamers.</p> <ul> <li>M\u00e9thode : <code>POST</code></li> <li>Chemin : <code>/users</code></li> <li>Acc\u00e8s : Public</li> </ul>"},{"location":"api/utilisateurs/#exemple-de-requete","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"firstName\": \"Alice\",\n  \"lastName\": \"Smith\",\n  \"email\": \"alice.smith@example.com\",\n  \"password\": \"SecurePassword123!\",\n  \"phone\": \"+33600000000\",\n  \"address\": \"10 Rue de Rivoli\",\n  \"city\": \"Paris\",\n  \"postalCode\": \"75004\",\n  \"country\": \"FR\",\n  \"dateOfBirth\": \"1992-08-24\"\n}\n</code></pre>"},{"location":"api/utilisateurs/#exemple-de-reponse-201-created","title":"Exemple de r\u00e9ponse (201 Created)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Utilisateur cr\u00e9\u00e9\",\n  \"payload\": {\n    \"id\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n    \"firstName\": \"Alice\",\n    \"lastName\": \"Smith\",\n    \"email\": \"alice.smith@example.com\",\n    \"status\": \"OK\",\n    \"createdAt\": \"2026-01-13T20:00:00Z\"\n    ...\n  }\n}\n</code></pre>"},{"location":"api/utilisateurs/#administration-des-utilisateurs","title":"Administration des Utilisateurs","text":"<p>Note : Les endpoints suivants n\u00e9cessitent un token Administrateur.</p>"},{"location":"api/utilisateurs/#lister-les-utilisateurs","title":"Lister les utilisateurs","text":"<p>R\u00e9cup\u00e8re la liste de tous les joueurs inscrits.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/users</code></li> <li>Acc\u00e8s : Admin</li> <li>Param\u00e8tres (Query) :</li> <li><code>status</code> : Filtrer par statut (<code>OK</code>, <code>SUSPENDED</code>, <code>BLOCKED</code>, <code>DELETED</code>).</li> </ul>"},{"location":"api/utilisateurs/#exemple-de-reponse-200-ok","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"Users retrieved successfully\",\n  \"payload\": [\n    {\n      \"id\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n      \"firstName\": \"Alice\",\n      \"lastName\": \"Smith\",\n      \"email\": \"alice.smith@example.com\",\n      \"phone\": \"+33600000000\",\n      \"status\": \"OK\",\n      \"createdAt\": \"2026-01-13T20:00:00Z\"\n      ...\n    },\n    {\n      \"id\": \"b2c3d4e5-f6g7-5h8i-9j0k-l1m2n3o4p5q6\",\n      \"firstName\": \"Bob\",\n      \"lastName\": \"Martin\",\n      \"email\": \"bob.martin@example.com\",\n      \"phone\": \"+33611111111\",\n      \"status\": \"OK\",\n      \"createdAt\": \"2026-01-14T10:00:00Z\"\n      ...\n    }\n  ]\n}\n</code></pre>"},{"location":"api/utilisateurs/#consulter-un-utilisateur","title":"Consulter un utilisateur","text":"<p>D\u00e9tails complets d'un joueur par son ID.</p> <ul> <li>M\u00e9thode : <code>GET</code></li> <li>Chemin : <code>/users/{userId}</code></li> <li>Acc\u00e8s : Admin</li> </ul>"},{"location":"api/utilisateurs/#exemple-de-reponse-200-ok_1","title":"Exemple de R\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"User details retrieved successfully\",\n  \"payload\": {\n    \"id\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n    \"firstName\": \"Alice\",\n    \"lastName\": \"Smith\",\n    \"email\": \"alice.smith@example.com\",\n    \"phone\": \"+33600000000\",\n    \"address\": \"10 Rue de Rivoli\",\n    \"city\": \"Paris\",\n    \"postalCode\": \"75004\",\n    \"country\": \"FR\",\n    \"dateOfBirth\": \"1992-08-24\",\n    \"status\": \"OK\",\n    \"paymentMethod\": {\n      \"type\": \"SEPA\",\n      \"iban\": \"FR76****************1234\"\n    },\n    \"createdAt\": \"2026-01-13T20:00:00Z\",\n    \"updatedAt\": \"2026-01-13T20:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"api/utilisateurs/#modifier-un-statut-financieracces","title":"Modifier un statut financier/acc\u00e8s","text":"<p>Permet de suspendre ou bloquer un utilisateur (souvent suite \u00e0 un incident de paiement).</p> <ul> <li>M\u00e9thode : <code>PATCH</code></li> <li>Chemin : <code>/users/{userId}/status</code></li> <li>Acc\u00e8s : Admin</li> </ul>"},{"location":"api/utilisateurs/#exemple-de-requete_1","title":"Exemple de requ\u00eate","text":"<pre><code>{\n  \"status\": \"BLOCKED\"\n}\n</code></pre>"},{"location":"api/utilisateurs/#exemple-de-reponse-200-ok_2","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"User status updated successfully\",\n  \"payload\": {\n    \"id\": \"a1b2c3d4-e5f6-4g7h-8i9j-k1l2m3n4o5p6\",\n    \"firstName\": \"Alice\",\n    \"lastName\": \"Smith\",\n    \"email\": \"alice.smith@example.com\",\n    \"status\": \"BLOCKED\"\n  }\n}\n</code></pre>"},{"location":"api/utilisateurs/#suppression-logique","title":"Suppression logique","text":"<p>D\u00e9sactive le compte d'un utilisateur sans supprimer les donn\u00e9es historiques.</p> <ul> <li>M\u00e9thode : <code>DELETE</code></li> <li>Chemin : <code>/users/{userId}</code></li> <li>Acc\u00e8s : Admin</li> </ul>"},{"location":"api/utilisateurs/#exemple-de-reponse-200-ok_3","title":"Exemple de r\u00e9ponse (200 OK)","text":"<pre><code>{\n  \"success\": true,\n  \"message\": \"User deleted successfully\",\n  \"payload\": null\n}\n</code></pre>"},{"location":"architecture/001-adr/","title":"Architecture Decision Records","text":""},{"location":"architecture/001-adr/#contexte","title":"Contexte","text":"<p>Le projet \"Gamers ERP\" n\u00e9cessite une API robuste pour g\u00e9rer des utilisateurs, des abonnements, et des exports comptables/bancaires. L'application doit \u00eatre maintenable, testable, et supporter potentiellement plusieurs types de bases de donn\u00e9es (dev/prod). Il est n\u00e9cessaire de d\u00e9finir une strat\u00e9gie claire pour l'exposition de l'API, la s\u00e9curit\u00e9, et l'acc\u00e8s aux donn\u00e9es.</p>"},{"location":"architecture/001-adr/#decisions","title":"D\u00e9cisions","text":""},{"location":"architecture/001-adr/#1-approche-contract-first-avec-openapi","title":"1. Approche \"Contract-First\" avec OpenAPI","text":"<p>Nous utilisons la sp\u00e9cification OpenAPI (<code>openapi.yaml</code>) comme source unique de v\u00e9rit\u00e9 pour notre API.</p> <ul> <li>Pourquoi : garantit que la documentation est toujours \u00e0 jour avec le code.</li> <li>Impl\u00e9mentation : g\u00e9n\u00e9ration automatique du routeur Express et des types TypeScript via <code>@nahkies/openapi-code-generator</code>.</li> <li>Validation : la validation des entr\u00e9es (Schema Validation) est d\u00e9l\u00e9gu\u00e9e aux validateurs g\u00e9n\u00e9r\u00e9s (Zod).</li> </ul>"},{"location":"architecture/001-adr/#2-architecture-en-couches-et-organisation-des-handlers","title":"2. Architecture en couches et organisation des handlers","text":"<p>Nous adoptons une architecture en couches pour s\u00e9parer les responsabilit\u00e9s. Les handlers sont organis\u00e9s par niveau d'acc\u00e8s :</p> <ul> <li>API Layer (<code>/api</code>) : d\u00e9finition des contrats et routage.</li> <li>Handler Layer (<code>/src/handler</code>) : orchestration des requ\u00eates HTTP.</li> <li><code>/public</code> : routes ouvertes (ex: cr\u00e9ation de compte).</li> <li><code>/authenticated</code> : routes n\u00e9cessitant une connexion simple.</li> <li><code>/admin</code> : routes r\u00e9serv\u00e9es aux administrateurs.</li> <li>Middleware Layer (<code>/src/middleware</code>) : fonctions transverses (Auth, Logs, Securit\u00e9 des routes).</li> <li>Repository Layer (<code>/src/repository</code>) : abstraction de l'acc\u00e8s aux donn\u00e9es.</li> <li>Database Layer (<code>/src/database</code>) : impl\u00e9mentations concr\u00e8tes (Drizzle ORM).</li> </ul>"},{"location":"architecture/001-adr/#3-strategie-dauthentification-bearer-jwt","title":"3. Strat\u00e9gie d'authentification : Bearer JWT","text":"<p>Nous utilisons des JSON Web Tokens (JWT) transmis via l'en-t\u00eate <code>Authorization: Bearer</code>.</p> <ul> <li>Pourquoi :</li> <li>Stateless : le serveur ne stocke pas de session en m\u00e9moire, id\u00e9al pour la scalabilit\u00e9.</li> <li>Standard : compatible avec tout type de client (Web, mobile, tiers).</li> <li>S\u00e9curit\u00e9 :</li> <li>les mots de passe sont hach\u00e9s avec <code>bcrypt</code> avant stockage.</li> <li>les mots de passe ne sont jamais renvoy\u00e9s dans les r\u00e9ponses API.</li> </ul>"},{"location":"architecture/001-adr/#4-abstraction-de-la-base-de-donnees","title":"4. Abstraction de la base de donn\u00e9es","text":"<p>Nous utilisons le pattern Repository pour d\u00e9coupler la logique m\u00e9tier de la base de donn\u00e9es.</p> <ul> <li>Interface : <code>UserRepository</code>, <code>SubscriptionRepository</code>, etc.</li> <li>Impl\u00e9mentations :</li> <li><code>InMemory...Repository</code> : pour les tests et le d\u00e9veloppement local (SQLite en m\u00e9moire).</li> <li><code>Postgres...Repository</code> : pour la production (PostgreSQL via Drizzle ORM).</li> </ul>"},{"location":"architecture/001-adr/#5-securite-centralisee-des-routes","title":"5. S\u00e9curit\u00e9 centralis\u00e9e des routes","text":"<p>La gestion des droits d'acc\u00e8s est centralis\u00e9e dans un middleware de s\u00e9curit\u00e9 pilot\u00e9 par une configuration (<code>routes.config.ts</code>).</p> <ul> <li>Pourquoi : \u00e9viter d'\u00e9parpiller les v\u00e9rifications <code>if (user.isAdmin)</code> dans chaque handler.</li> <li>Impl\u00e9mentation : le middleware <code>secureRouteMiddleware</code> intercepte chaque requ\u00eate, consulte <code>ROUTE_RULES</code> pour d\u00e9terminer le niveau d'acc\u00e8s requis (<code>public</code>, <code>authenticated</code>, <code>admin</code>), et valide le token JWT en cons\u00e9quence.</li> </ul>"},{"location":"architecture/001-adr/#benefices","title":"B\u00e9n\u00e9fices","text":"<ul> <li>Tests facilit\u00e9s par l'injection de d\u00e9pendances.</li> <li>Logique m\u00e9tier prot\u00e9g\u00e9e des d\u00e9tails d'impl\u00e9mentation HTTP ou SQL.</li> <li>Documentation API claire et interactive (Swagger UI) disponible par d\u00e9faut.</li> </ul>"},{"location":"architecture/001-adr/#points-de-vigilance","title":"Points de vigilance","text":"<ul> <li>L\u00e9g\u00e8re complexit\u00e9 ajout\u00e9e par l'\u00e9tape de g\u00e9n\u00e9ration de code (<code>npm run generate</code>).</li> <li>N\u00e9cessit\u00e9 de maintenir la synchro entre <code>openapi.yaml</code> et le code (le build \u00e9choue si d\u00e9synchronis\u00e9, ce qui est une s\u00e9curit\u00e9).</li> </ul>"},{"location":"architecture/002-authentification/","title":"Architecture d'authentification","text":""},{"location":"architecture/002-authentification/#contexte","title":"Contexte","text":"<p>Le backend sert trois types de clients avec diff\u00e9rents mod\u00e8les de confiance :</p> <ol> <li>Utilisateurs externes via Connect Gateway</li> <li>Services internes (communication S2S)</li> <li>Admin SPA (acc\u00e8s direct Backoffice)</li> </ol> <p>Nous avions besoin d'un flux d'authentification unifi\u00e9 g\u00e9rant les trois sans duplication de code.</p>"},{"location":"architecture/002-authentification/#decision","title":"D\u00e9cision","text":""},{"location":"architecture/002-authentification/#flux-dauthentification","title":"Flux d'authentification","text":"<pre><code>flowchart TD\n    Start([REQU\u00caTE RE\u00c7UE]) --&gt; APIKey{apiKey pr\u00e9sente dans le body ?}\n    APIKey -- \"OUI\" --&gt; Connect[\"CONNECT MIDDLEWARE&lt;br/&gt;1. Valide apiKey&lt;br/&gt;2. Extrait userData\"]\n    APIKey -- \"NON\" --&gt; Bypass[\"BYPASS direct\"]\n\n    Connect --&gt; SetConnect[\"isConnectRequest=true&lt;br/&gt;req.user = userData\"]\n    Bypass --&gt; SetNormal[\"isConnectRequest=undefined\"]\n\n    SetConnect --&gt; Auth[\"AUTH MIDDLEWARE\"]\n    SetNormal --&gt; Auth\n\n    Auth --&gt; CheckCase{Cas}\n    CheckCase -- \"isConnectRequest = true\" --&gt; S2S[\"CONFIANCE S2S&lt;br/&gt;Acc\u00e8s total\"]\n    CheckCase -- \"req.user existe\" --&gt; Perms[\"V\u00c9RIF PERMS&lt;br/&gt;(admin/user)\"]\n    CheckCase -- \"Aucun\" --&gt; JWT[\"VALIDER JWT&lt;br/&gt;depuis header\"]</code></pre>"},{"location":"architecture/002-authentification/#chemins-dacces","title":"Chemins d'acc\u00e8s","text":"Chemin Client apiKey JWT valid\u00e9 par <code>isConnectRequest</code> <code>req.user</code> Gateway Utilisateur externe Oui Connect <code>true</code> Depuis userData S2S Service interne Oui N/A <code>true</code> <code>undefined</code> Direct Admin SPA Non Backend <code>undefined</code> Depuis JWT"},{"location":"architecture/002-authentification/#details-dimplementation","title":"D\u00e9tails d'impl\u00e9mentation","text":"<ol> <li> <p><code>shouldBypassConnect()</code> - Retourne <code>true</code> si pas d'<code>apiKey</code>, saute le middleware connect.</p> </li> <li> <p>Flag <code>isConnectRequest</code> - D\u00e9fini \u00e0 <code>true</code> uniquement avec une <code>apiKey</code> valide.</p> </li> <li> <p>Contexte utilisateur - Peut provenir de :</p> </li> <li><code>userData</code> de Connect (chemin Gateway)</li> <li>JWT dans l'en-t\u00eate Authorization (chemin Direct)</li> </ol>"},{"location":"architecture/002-authentification/#flux-spa-direct-sans-apikey-de-connect","title":"Flux SPA Direct (sans apiKey de Connect)","text":"<pre><code>sequenceDiagram\n    participant SPA as Admin SPA\n    participant CM as connect.middleware.ts\n    participant AM as auth.middleware.ts\n    SPA-&gt;&gt;CM: GET /users (sans apiKey)\n    Note over CM: shouldBypassConnect(req) returns TRUE\n    Note over CM: SAUTE ce middleware\n    CM-&gt;&gt;AM: isConnectRequest = undefined\n    Note over AM: authenticateWithToken()\n    Note over AM: Extrait &amp; V\u00e9rifie JWT de l'en-t\u00eate\n    Note over AM: D\u00e9finit req.user\n    AM--&gt;&gt;SPA: \"Autoris\u00e9 ou Refus\u00e9 (Permissions)\"</code></pre>"},{"location":"architecture/002-authentification/#cycle-de-vie-du-token","title":"Cycle de vie du token","text":"<ul> <li>G\u00e9n\u00e9ration : Backend (<code>security.generateToken()</code>, <code>security.generateAdminToken()</code>)</li> <li>Validation (Gateway) : Connect Gateway</li> <li>Validation (Direct) : Backend (<code>security.verifyToken()</code>)</li> </ul> <p>Les deux doivent utiliser le m\u00eame <code>JWT_SECRET</code> / <code>CONNECT_JWT_SECRET</code>.</p>"},{"location":"architecture/002-authentification/#consequences","title":"Cons\u00e9quences","text":""},{"location":"architecture/002-authentification/#positives","title":"Positives","text":"<ul> <li>Une seule pile middleware g\u00e8re tous les patterns d'acc\u00e8s</li> <li>Pas de validation JWT redondante</li> <li>Les services S2S ont un acc\u00e8s complet avec la cl\u00e9 API</li> <li>S\u00e9paration claire des fronti\u00e8res de confiance</li> </ul>"},{"location":"architecture/002-authentification/#negatives","title":"N\u00e9gatives","text":"<ul> <li><code>JWT_SECRET</code> doit \u00eatre synchronis\u00e9 entre Connect et Backend</li> <li>L'acc\u00e8s SPA direct n\u00e9cessite de maintenir <code>verifyToken()</code> dans le Backend</li> </ul>"},{"location":"architecture/002-authentification/#fichiers-concernes","title":"Fichiers Concern\u00e9s","text":"<ul> <li><code>src/middleware/connect.middleware.ts</code></li> <li><code>src/middleware/auth.middleware.ts</code></li> <li><code>src/utils/security.ts</code></li> </ul>"},{"location":"architecture/003-permission/","title":"Permissions &amp; autorisations","text":""},{"location":"architecture/003-permission/#vue-densemble","title":"Vue d'ensemble","text":"<p>Le Backend applique les permissions \u00e0 deux niveaux :</p> <ol> <li>Connect (Gateway) - V\u00e9rifie l'acc\u00e8s AVANT de transf\u00e9rer au Backend</li> <li>Backend - V\u00e9rifie \u00e0 nouveau en backup (d\u00e9fense en profondeur)</li> </ol>"},{"location":"architecture/003-permission/#niveaux-de-permission-bitmask","title":"Niveaux de permission (bitmask)","text":"Permission Valeur Binaire Description Public 0 00 Aucune authentification requise Authentifi\u00e9 1 01 Utilisateurs connect\u00e9s Admin 3 11 Acc\u00e8s total (auth + admin) <p>Note : Admin = 3 (pas 2) pour avoir acc\u00e8s aux routes authenticated ET admin.</p>"},{"location":"architecture/003-permission/#verification-des-permissions","title":"V\u00e9rification des permissions","text":"<p>Connect et Backend utilisent le m\u00eame check bitmask :</p> <pre><code>(user.permission &amp; route.permission) === route.permission\n</code></pre>"},{"location":"architecture/003-permission/#exemples","title":"Exemples","text":"User Perm Route Perm Calcul R\u00e9sultat 1 (user) 1 (auth) 1 &amp; 1 = 1 Autoris\u00e9 3 (admin) 1 (auth) 3 &amp; 1 = 1 Autoris\u00e9 3 (admin) 2 (admin) 3 &amp; 2 = 2 Autoris\u00e9 1 (user) 2 (admin) 1 &amp; 2 = 0 Refus\u00e9"},{"location":"architecture/003-permission/#flux-requete-vers-route-protegee","title":"Flux : Requ\u00eate vers route prot\u00e9g\u00e9e","text":"<pre><code>sequenceDiagram\n    participant U as Utilisateur (Perm=1)\n    participant C as Connect Gateway\n    participant B as Backend\n    U-&gt;&gt;C: GET /users (Admin Only)\n    Note over C: D\u00e9code JWT : permission: 1\n    Note over C: Route /users requiert: 2\n    Note over C: Check: (1 &amp; 2) == 2 ? result 0 != 2\n    C--&gt;&gt;U: 403 Forbidden</code></pre> <p>Admin (permission=3) acc\u00e8de \u00e0 la m\u00eame route :</p> <pre><code>sequenceDiagram\n    participant A as Admin (Perm=3)\n    participant C as Connect Gateway\n    participant B as Backend\n    A-&gt;&gt;C: GET /users (Admin Only)\n    Note over C: D\u00e9code JWT : permission: 3\n    Note over C: Route /users requiert: 2\n    Note over C: Check: (3 &amp; 2) == 2 ? result 2 == 2\n    C-&gt;&gt;B: Transf\u00e8re la requ\u00eate\n    B--&gt;&gt;A: 200 OK</code></pre>"},{"location":"architecture/003-permission/#configuration-des-routes","title":"Configuration des routes","text":"<p>D\u00e9finie dans <code>src/middleware/routes.config.ts</code> :</p> <pre><code>export const ROUTES: Route[] = [\n  // PUBLIC (permission: 0)\n  { path: '/auth/login', method: 'POST', access: 'public' },\n\n  // AUTHENTIFI\u00c9 (permission: 1)\n  { path: '/subscriptions', method: 'GET', access: 'authenticated' },\n\n  // ADMIN (permission: 2 - mais user doit avoir 3 pour y acc\u00e9der)\n  { path: '/users', method: 'GET', access: 'admin' },\n];\n</code></pre>"},{"location":"architecture/003-permission/#fichiers-concernes","title":"Fichiers concern\u00e9s","text":"<ul> <li><code>src/middleware/routes.config.ts</code> - D\u00e9finitions d'acc\u00e8s aux routes</li> <li><code>src/middleware/auth.middleware.ts</code> - Logique d'autorisation (bitmask)</li> <li><code>src/utils/security.ts</code> - G\u00e9n\u00e9ration des tokens (user=1, admin=3)</li> </ul>"}]}